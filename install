#!/usr/bin/env node

/*jslint node: true */
'use strict';

var path = require('path'),
    spawn = require('child_process').spawn;

console.log('Installing titanium stuff...');

console.log('--- Installing Build Command(s) ---');
exec('ti', ['config', '-a', 'paths.hooks', path.join( __dirname , 'plugin')], null, function() {
    console.info('Titanium CLI command installed.');
});


function exec(cmd, args, opts, callback) {

  if (process.platform === 'win32') {
    args = ['/c', cmd].concat(args);
    cmd = process.env.comspec;
  }

  opts = opts || {};

  if (!opts.stdio && !opts.capture) {
    opts.stdio = 'inherit';
  }

  var s = spawn(cmd, args, opts);
  var output;

  if (opts.stdio !== 'inherit') {
    s.stderr.pipe(process.stderr);
  }

  if (opts.capture) {
    output = '';
    s.stdout.on('data', function(data) {
      output += data.toString();
    });

  } else {

    if (opts.stdio !== 'inherit') {
      s.stdout.pipe(process.stdout);
    }

    output = null;
  }

  s.on('exit', function() {
    callback(output);
  });

  return s;
}